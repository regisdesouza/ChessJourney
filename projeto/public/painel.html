<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel</title>    
<link rel="stylesheet" href="./css/painel.css">
</head>
<body onload="carregarQuizzes()">

<div class="menuLateral">
    <h2>Painel</h2>
    <a href="./painel.html">Início</a>
    <a href="./tabuleiro.html">Desafio</a>
    <a href="./dash-usuario.html">Estatísticas</a>
    <button id="btnSair">Sair</button>
</div>

<div class="container" > 
    <div class="linhaInfos">
        <div class="cardInfo">
            <h3>Bem-vindo</h3>
            <p id="nomeUsuario"></p>
        </div>
    </div>

    <div id="secaoQuiz">
        <h3>Quizzes Disponíveis</h3>
        <div id="listaQuizzes"></div>
    </div>

    <div id="secaoRecomendacao">
        <h3>Recomendações</h3>
        <div id="listaRecomendacoes"></div>
    </div>
</div>

<script>

document.getElementById("nomeUsuario").innerHTML = sessionStorage.NOME_USUARIO;

document.getElementById("btnSair").onclick = function () {
    fetch("/usuarios/sair").then(() => {
        window.location.href = "tela-login.html";
        sessionStorage.clear();
    });
};


function carregarQuizzes() {
    fetch("/quiz/listar")
        .then(r => r.json())
        .then(lista => {
            if (!lista || lista.length === undefined) return;

            const div = document.getElementById("listaQuizzes");
            div.innerHTML = "";

            for (let i = 0; i < lista.length; i++) {
                const q = lista[i];
                const box = document.createElement("div");
                box.className = "quizBox";

                box.innerHTML = `
                    <p>${q.titulo}</p>
                    <button>Iniciar</button>
                `;

                box.querySelector("button").onclick = function () {
                    sessionStorage.ID_QUIZ = q.id_quiz;
                    window.location.href = "quiz.html";
                };

                div.appendChild(box);
            }

            carregarRecomendacoes(lista);
        });
}

function carregarRecomendacoes(quizzes) {
    const div = document.getElementById("listaRecomendacoes");
    div.innerHTML = "";

    for (let i = 0; i < quizzes.length; i++) {
        const q = quizzes[i];

        fetch("/painel/recomendacoes/" + q.id_quiz)
            .then(r => r.json())
            .then(lista => {
                if (!lista || lista.length === undefined) return;

                for (let j = 0; j < lista.length; j++) {
                    const rec = lista[j];
                    const box = document.createElement("div");
                    box.className = "rec";

                    box.innerHTML = `
                        <h4>${rec.titulo}</h4>
                        <p>${rec.descricao}</p>
                        <p>${rec.conteudo}</p>
                        ${rec.url_recurso ? `<a href="${rec.url_recurso}" target="_blank">Acessar recurso</a>` : ""}
                    `;

                    div.appendChild(box);
                }
            });
    }
}

function limparSessao() {
    sessionStorage.clear(); 
    window.location.href = "../tela-login.html"; 
}

</script>

</body>
</html>
